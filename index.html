<html>
<head>

	<title>Beer Softball League</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css">
	<!--<link rel="stylesheet" type="text/css" href="css/stylesheet.css"> -->
    <link rel="stylesheet" type="text/css" href="css/boob.css"> 
	<script type="text/javascript" src="js/jquery.min.js"></script>	
	<script src="js/bootstrap.js"></script>
	<script src="js/jquery.validate.js"></script>
	
  <script>
//$(document).ready(function() { 
//     $( "#standings" ).popover({
//       selector: 'span.link',
//       trigger: "hover focus" ,
//       html:true, 
//     });
// });
    </script>


</head>
<body>
<body>
   <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
<!--             <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> -->
          </button>
          <a class="brand" href="./index.html"><!-- Bootstrap --></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="">
                <a href="./index.html">Home</a>
              </li>
              <li class="">
                <!-- <a href="./getting-started.html">Add Your Team</a> -->

                <!-- <a href= "#myModal" data-target= "#create_team" data-toggle="modal">Add Your Team</a> -->

                <a href= "#" onclick="howManyTeams()">Add Your Team</a>

              </li>
              <li class="">
                <a href="./scaffolding.html">Standings</a>
              </li>
              <li class="">
                <a href="./base-css.html">Weekly Results</a>
              </li>
              <li class="active">
                <a href="./components.html">Team Page</a>
              </li>
<!--               <li class="dropdown-submenu">
                <a href="./customize.html">Dropdown</a>
                	<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                		<li><a tabindex="-1" href="#">Action</a></li>
    					<li><a tabindex="-1" href="#">Another action</a></li>
    					<li><a tabindex="-1" href="#">Something else here</a></li>
              </li> -->
            </ul>
          </div>
        </div>
      </div>
    </div>

	<!-- end of Nav Bar -->	


	<div class="clearfix"></div>
	<div class="container">
		<div class="row-fluid" style="text-align: center;">
			<br/><br/>
			<h1>Standings</h1>
		</div>
<!-- 		Standings Heading    -->
		<div class="row-fluid">
			<div class="span10 offset1">
      <table id="standings" class="table table-striped">
				<tr><th><h4>Team</h4></th><th><h4>Wins</h4></th><th><h4>Loses</h4></th><th><h4>W/L %</h4></th></tr>
			</table>
      </div>
		</div> <!-- end table row -->


<!-- Weekly Standings -->
  <div class="clearfix"></div>
  <div class="container">
    <div class="row-fluid" style="text-align: center;">
      <br/><br/>
      <h2>Weekly Scores</h2>
    </div>
<!--    Standings Heading    -->
    <div class="row-fluid">
      <div class="span10 offset1">
      <table id="weeklyScores" class="table table-striped">
        <!-- <tr><th>Home Team</th><th>Runs</th><th>Runs</th><th>Away Team</th></tr> -->
      </table>
    </div> <!-- end table row -->

<!-- END: Weekly Standings -->

    <div class="row"> <!--content-->
      <div class="span10">

      <div class="playing">
        <div class="row">
          <!--Teams-->
          <div class="span2">
<!--             <img src="img/beer-icon.png"></img>
 -->          </div>
          <div class="span8 teams">
            <!-- <div class="row-fluid" style="text-align: center;"> -->
             <h3>Active Teams</h3>
               <div id="teamList">
               <!-- This will be populated by function populateTeamList -->
               </div>

<!-- Create the Modal For a FULL League -->
  <div id="full_league" class="modal hide fade">
    <div class="modal-header" style="text-align: center">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>We are sorry to inform you, our league is FULL. <p>A total of 8 teams are allowed.<p></h3>
    </div>
  </div>
<!-- END: Create the Modal For a Full League -->



<!-- Create the Weekly Scores Form Entry -->
  <div id="enter_weekly_scores" class="modal hide fade">
    <!-- <div class="modal-header"> -->
        <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
        <!-- <h3>Enter Your Teams Weekly Scores.</h3> -->
    </div>
    <div class="modal-body">
      <form id="modal_form" class="form-horizontal">
        <div class="control-group weekly_scores insideWeeklyScores">
          <!-- Append via "weekly_scores" form here -->

        </div>
      </form> <!-- Close form -->
    </div> <!-- Close class="modal-body" --> 
  </div> <!-- Close enter_weekly_scores DIV -->
<!-- END: the Weekly Scores Form Entry -->



<!-- Create the Modal For too few teams -->
  <div id="less_than_4_teams" class="modal hide fade">
    <div class="modal-header" style="text-align: center">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>We are sorry you can not enter weekly scores. <p>There are too few teams.</p><p>(there must be 4 or greater)</p></h3>
    </div>
  </div>
<!-- END: the Modal For too few teams -->


<!-- Create the Modal Team Form Entry -->
	<div id="create_team" class="modal hide fade">
		<div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		    <h3>Register Your Team</h3>
		</div>
		<div class="modal-body">
			<form id="modal_form" class="form-horizontal">
				<div class="control-group">
			    	<label class="control-label" for="teamname">Team Name</label>
			    		<div class="controls">
			      			<input type="text" class="team_inputs" id="teamName" name="teamname" placeholder="i.e. Cowboys">
			    		</div>
			  	</div>


		<div class="control-group">
			<label class="control-label" for="firstname">Manager</label>
			  	<div class="controls">
				  	<form class="form-inline">
							<input type="text" class="input-small team_inputs" id="firstName" name="firstname" placeholder="firstname" >
				      		<input type="text" class="input-large team_inputs" id="lastName" name="lastname" placeholder="lastname">
				     </form>
			     </div>
		</div>
			  
		<div class="control-group">
			<label class="control-label" for="phone">Phone Number</label>
			    <div class="controls">
			      	<input type="text" id="phone" class="team_inputs" name="phone" placeholder="555-555-1234">
			   </div>
		</div>

		<div class="control-group">
			<label class="control-label" for="phone">Email</label>
			    <div class="controls">
			      	<input type="text" id="email" class="team_inputs" name="phone" placeholder="your@emailaddress">
			   </div>
		</div>
			  
		<div class="control-group">
			<label class="control-label" for="sponsor">Team Sponsor</label>
			    <div class="controls">
			      	<input type="text" class="team_inputs" id="sponsor" name="sponsor" placeholder="Cool Springs Brewery">
			    </div>
		</div>
		<div class="control-group">
			<label class="control-label" for="zipcode">Zipcode</label>
			    <div class="controls">
			      	<input type="text" class="team_inputs" id="zipcode" name="zipcode" placeholder="75252" >
			    </div>
		</div>
		<div class="control-group">
			<div class="controls">
			      <button id="createTeam" type="submit" class="btn" data-dismiss="modal" aria-hidden="true" onclick="addTeam()"> Submit</button>
			</div>
		</div>
			</form>
		</div>
	</div>	  <!-- End of Team Modal Form -->

<script>
// ==================================================
//           The Array Way
// ==================================================
	// $(document).ready(function(){
	// 	var league_array=[];
	// 	$("#createTeam").click(function(){
	// 		var team_array=[];
	// 		$(".team_inputs").each(function(){
	// 			team_array.push($(this).val());
	// 		}); //close team array
	// 		league_array.push(team_array);
	// 		console.log(league_array);
	// 		printTeam(team_array);
	// 		clearForm();
	// 	}); //close click
	// 	function printTeam(team_array){
	// 		$("#standings").append("<tr><th>" + team_array[0] + "</th></tr>");
	// 	};
	// 	function clearForm(){
	// 		$(".team_inputs").each(function(){
	// 			$(this).val("");
	// 		});
	// 	};

	// });
//console.log(team_array);
// ==================================================
//          END: The Array Way
// ==================================================

// ==================================================
//          Schedule Data
// ==================================================

var sched4 = [ [ [1, 4], [2, 3] ], [ [1, 3], [2, 4] ], [ [1, 2], [3, 4] ] ]; 
var sched6 = [ [ [1, 6], [2, 5], [3, 4] ], [ [1, 5], [4, 6], [2, 3] ], [ [1, 4], [3, 5], [2, 6] ], [ [1, 3], [2, 4], [5, 6] ], [ [1, 2], [3, 6], [4, 5] ], ]; 
var sched8 = [ [ [1, 8], [2, 7], [3, 6], [4, 5] ], [ [1, 7], [6, 8], [2, 5], [3, 4] ], [ [1, 6], [5, 7], [4, 8], [2, 3] ], [ [1, 5], [4, 6], [3, 7], [2, 8] ], [ [1, 4], [3, 5], [2, 6], [7, 8] ], [ [1, 3], [2, 4], [5, 8], [6, 7] ], [ [1, 2], [3, 8], [4, 7], [5, 6] ], ];
// ==================================================

// ==================================================
//          Load existing team data
// ==================================================
$(document).ready(function () {
  // get from database: Purpose, fill array with data if exists
  $.ajax({
    url: 'backliftapp/teamInfo',
    type: "GET",
    dataType: "json",
    success: function (data) {
      leagueAll = data;
      for (var i = 0; i < data.length; i++) {
        addTeamToTable(data[i]);
        populateTeamList(data[i]);
        // populateWeeklyScores(data[i]);
      }
      populateWeeklyScores(data);
    }
  }); // end ajax
}); // end ready
// ==================================================
//          END: Load existing team data
// ==================================================


// ==================================================
// Add team info from form to backlift JSON data file
// ==================================================
var leagueAll = [];
// add team to league
function addTeam() {
  var teamInfo = {
    teamName: $("#teamName").val(),
    firstName: $("#firstName").val(),
    lastName: $("#lastName").val(),
    phone: $("#phone").val(),
    email: $("#email").val(),
    sponsor: $("#sponsor").val(),
    zipcode: $("#zipcode").val(),
    week01runs: 0,
    week02runs: 0,
    week03runs: 0,
    week04runs: 0,
    week05runs: 0,
    week06runs: 0,
    week07runs: 0,
    week08runs: 0,
    totalWins: (((Math.floor)(Math.random()*11))+1),   //random number generated at this time
    totalLosses: (((Math.floor)(Math.random()*6))+1)
  };

  $.ajax({
    url: 'backliftapp/teamInfo',
    type: "POST",
    dataType: "json",
    data: teamInfo,
    success: function (data) {
      // console.dir(data);
      leagueAll.push(data);
      addTeamToTable(data);
      populateTeamList(data);
      populateWeeklyScores(data);
      // doPopovers();
      //put teamInfo in the table of teams
      // track(data.name + " saved to database!");
    }
  });

};
// ==================================================
// END: add team
// ==================================================

// ==================================================
// Add team to Standings
// ==================================================
function addTeamToTable(team) {
  $(
     "<tr>" +
    // "<td>" + team.id + "</td>" +
    // Deleted the non-needed information 
    "<td><span rel='popover' class='show link' data-original-title='Team Info' data-content='Manager: " + team.firstName + " " + team.lastName + "<br/>Phone: " + team.phone + "<br/>Sponsor: " + team.sponsor + "<br/>Zipcode: " + team.zipcode + "'>" + team.teamName + "</span></td>" +
    "<td>" + team.totalWins + "</td>" +
    "<td>" + team.totalLosses + "</td>" +
    "<td>" + wlPercent(team) + "</td>" +
    "</tr>").appendTo('#standings'); //tbody

    $( "#standings" ).popover({
      selector: 'span.link',
      trigger: "hover focus" ,
      html:true,  
      placement: "right"
    });

};
// ==================================================
// END: Add team to Standings
// ==================================================



// ==================================================
// Write each Active Team to screen
// ==================================================
function populateTeamList(team) {
  $(
    "<h4 class='show'>" + team.teamName + " <em>sponsored by</em> " + team.sponsor + " </h4>" + 
    "<p class='more'>" +
    "Manager: " + team.firstName + " " + team.lastName + "<br>" +
    "Phone: " + team.phone + "<br>" +
    "E-mail: " + team.email + "<br>" +
    "<button aria-hidden='true' class='btn' onclick='addWeeklyScores(\"" + team.id + "\", \"" + team.teamName + "\")'>Add Weekly Scores for the "+ team.teamName + "</button>" + "<br>" +
    "Team ID = " + team.id + "<br>" +
    "<button aria-hidden='true' class='btn btn-danger' onclick='deleteTeam(\"" + team.id + "\")'>Delete Team "+ team.teamName + "</button>" + "<br>" +
    "</p>").appendTo('#teamList');
};
// ==================================================
// END: Write each Active Team to screen
// ==================================================

// ==================================================
// Create Modal to enter weekly scores
// ==================================================
// This function is called by populateWeeklyScores()
function populateWeeklyScoresModal(teamCount, teamID, teamName){
    console.log("TeamCount: " + teamCount)
    clearForm(); 
    $('#enter_weekly_scores').empty()
    $("<div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h3>Enter Weekly Scores for " + teamName + ":</h3></div>").appendTo('#enter_weekly_scores') 
    $("<br>").appendTo('#enter_weekly_scores');
    
    var html = '<form id="my-form-id" class="form-horizontal control-group">';

    for (var i = 1; i <= teamCount; i++) {
         html += "<div class='Bbox'><label class='control-label' for='week0" + i +"runs'>Week " + i + 
           " Run total:</label> <div class='controls'> <input type='text' class='team_inputs span1' id='week0" + i +
           "runs' name='week0" + i + "runs'> <br> </div></div></div>";
     }

     html += '</form>';

     $(html).appendTo('#enter_weekly_scores');

     $("<div class='modal-footer'><button id='updateScores' type='submit' class='btn offset2' data-dismiss='modal' aria-hidden='true' onclick='updateTeamScore(\"" + teamID + "\", \"" + teamCount + "\")'> Submit</button></div>").appendTo('#enter_weekly_scores');
     // $('#enter_weekly_scores').empty()
     
}
//onclick='addTeam()'
// ==================================================
// END: Create Modal to enter weekly scores
// ==================================================

function updateTeamScore(teamID, teamCount){
  var form = $('#my-form-id');
  var data = form.serialize();
  console.log('Form: ', form);
  console.log('Data: ', data);
  $.ajax({
    url: 'backliftapp/teamInfo/' + teamID,
    type: "PUT",
    dataType: "json",
    data: data,
    success: function(data){
      console.log('Success: ', data);
    }
  });
}  
  


function populateWeeklyScores(team){
  $('#weeklyScores').empty()
  $.ajax({
    url: 'backliftapp/teamInfo',
    type: "GET",
    dataType: "json",
    success: function (data) {
      console.log("data.length: " + data.length)
      if (data.length===4){
        SCHED = sched4;
        // console.log("inside 4");
        // console.log(SCHED);
      }
      else if ((data.length === 5) || (data.length === 6)){
        SCHED = sched6;
        // console.log("inside 5 and 6");
        // console.log(SCHED);
        // console.log("data.length= " + data.length);
      }
      else if ((data.length === 7) || (data.length === 8)){
        SCHED = sched8;
        // console.log("inside 7 & 8");
        // console.log(SCHED);
      }
      if (data.length % 2 === 0) {
        billy = data.length % 2;
        // console.log("billy = " + billy)
        // console.log("even write SCHED")
        // console.log("in EVENSCHEDLOOP data = " + data)
        writeSCHEDeven(data, SCHED)
      }
      else {
        writeSCHEDodd(data, SCHED)
        console.log("odd write SCHED")
      }
    } // end success
  }) 
  //"").appendTo('weeklyScores');
} //end function

function writeSCHEDeven(data, SCHED) { //writes scheduletable for even-# leagues (4,6,8 teams)
      $("<tr><th><h4>Week</h4></th><th><h4>Home Team</h4></th><th><h4>Runs</h4></th><th><h4>Runs</h4></th><th><h4>Away Team</h4></th></tr>").appendTo('#weeklyScores');

        for (var i = 0; i < SCHED.length; i++) {   //weeks loop
          if (data.length === 4){
            var numOfGamesEachWeek = 1;
          }
          else if (data.length === 6){
            var numOfGamesEachWeek = 2;
          }
          else if (data.length === 8){
            var numOfGamesEachWeek = 3;
          }
            for (var k =0; k < (SCHED.length-numOfGamesEachWeek); k++) { //loop within a loop
              var l = 0; //alternates between home and away teamName
              $("<tr><td>"+(i+1)+"</td><td>" +
               data[((SCHED[i][k][l])-1)].teamName  +
                "</td><td>" + eval("data[((SCHED[i][k][l])-1)].week0" +(i+1) +"runs") + "</td><td>"+ eval("data[((SCHED[i][k][l+1])-1)].week0" +(i+1)+"runs")+"</td><td>"+
                data[((SCHED[i][k][l+1])-1)].teamName+
                "</td></tr>").appendTo('#weeklyScores');
            };
        };
      };


    function writeSCHEDodd(data, sched) { //writes scheduletable for odd-# leagues (5,7 teams)
      $("<tr><th>Week</th><th>Home Team</th><th>Runs</th><th>Runs</th><th>Away Team</th></tr>").appendTo('#weeklyScores');
        console.log("SCHED.length = " + SCHED.length)
        for (var i = 0; i < SCHED.length; i++) {   //weeks loop
          if (data.length === 5){
            var numOfGamesEachWeek = 3;
          }
          else if (data.length === 7){
            var numOfGamesEachWeek = 4;
          }
            for (var k =1; k < numOfGamesEachWeek; k++) { //loop within a loop
              var l = 0; //alternates between 1st and 2nd team listed for each game
              console.log("i = " + i)
              console.log("k = " + k)
              console.log("FAILS ((SCHED[i][k][l+1])-1) = " + ((SCHED[i][k][l+1])-1))
              //console.log("num, teamName = " + ((SCHED[i][k][l+1])-1) + " "+ data[((SCHED[i][k][l+1])-1)].teamName)
              $("<tr><th>"+(i+1)+"</th><th>" +
               data[((SCHED[i][k][l])-1)].teamName  +
                "</th><th>" + data[((SCHED[i][k][l])-1)].week01runs + "</th><th>"+ data[((SCHED[i][k][l+1])-2)].week01runs +"</th><th>"+
                data[((SCHED[i][k][l+1])-2)].teamName+
                "</th></tr>").appendTo('#weeklyScores');
            };        
        };
      };

// ==================================================
// Create a new Team? if the team count is less >=8 show new team modal, if not show tooFewTeams modal
// ==================================================
function howManyTeams(){
  $.ajax({
    url: 'backliftapp/teamInfo',
    type: "GET",
    dataType: "json",
    success: function (data) {
      //howManyTeamsAreThere();
      if (data.length>=8){
       //alert("Sorry the league is FULL. \n(6 teams total allowed)")
       $('#full_league').modal('show')
      }
      else{
        $('#create_team').modal('show')
        //howManyTeamsAreThere()
        clearForm(); 
      }  //end else
    } //end of success function
  })  //end of ajax
};    //end of function

//$(document).ready(

// ==================================================
// Calls modal for either too few teams or adding weekly scores
// ==================================================
function addWeeklyScores(teamID, teamName){
    console.log("teamID: " + teamID + "teamName: " + teamName)
    $.ajax({
      url: 'backliftapp/teamInfo',
      type: "GET",
      dataType: "json",
      success: function (data) {
        if (data.length<=8 && data.length>=4){
         $('#enter_weekly_scores').modal('show')
         populateWeeklyScoresModal(data.length, teamID, teamName)
        }
        else if (data.length<4){
          $('#less_than_4_teams').modal('show')
        }
      }
    }) // end ajax
}; // end function
// ==================================================
// END: Calls modal for either too few teams or adding weekly scores
// ==================================================


function howManyWeeksOfScores(){
    $.ajax({
      url: 'backliftapp/teamInfo',
      type: "GET",
      dataType: "json",
      success: function (data) {
        console.log("data.length= " + data.length)
      } //end of success
    })// end of ajax
} // end of howManyWeeksOfScores


// ==================================================
// Clears both modals when called
// ==================================================
   function clearForm(){
     $(".team_inputs").each(function(){
       $(this).val("");
      });
     $(".enter_weekly_scores").each(function(){
       $(this).val("");
      });
  }
// ==================================================
// END: Clears both modals when called
// ==================================================

// ==================================================
// Calculate WL%
// ==================================================
function wlPercent(team){
	wl = ((+team.totalWins)/((+team.totalWins)+(+team.totalLosses)));
	if(isNaN(wl)){
		return "No Games Played"
	}
	else {
		var formatWL = (wl.toFixed(3)).toString().replace(/^0+/, '')
		return formatWL
	}
};
// ==================================================
// END:Calculate WL%
// ==================================================

// ==================================================
// Delete selected team
// ==================================================
function deleteTeam(id) {
  console.log(id)
  var conf = confirm("Are you sure you want to delete this team?");
  if (conf == true) {
    $.ajax({
      url: "backliftapp/teamInfo/" + id,
      type: "DELETE",
      dataType: "json",
    });
  //track("deleted: " + id)
  //$(this).closest('tr').remove()
  }
};
// ==================================================
// END: Delete selected team
// ==================================================

</script>
	
</body>
</html>